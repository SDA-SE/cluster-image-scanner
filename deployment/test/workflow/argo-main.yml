apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: orchestration-
spec:
  ttlStrategy:
    secondsAfterSuccess: 3600
    secondsAfterFailure: 86400
  artifactRepositoryRef:
    configMap: artifact-repositories
    key: default-v1
  entrypoint: main
  templates:
    - name: main
      steps:
        - - name: run-subflow
            template: subflow
            arguments:
              parameters:
                - name: REGISTRY_SECRET
                  value: clusterscannerregistry
                - name: DEPENDENCY_SCAN_CM
                  value: dependency-check-db
                - name: DEFECTDOJO_CM
                  value: defectdojo-test
                - name: DEFECTDOJO_SECRETS
                  value: defectdojo-test
                - name: image
                  value: "{{ item.image }}"
                - name: image_id
                  value: "{{ item.image_id }}"
                - name: slack
                  value: "{{ item.slack }}"
                - name: skip
                  value: "{{ item.skip }}"
                - name: team
                  value: "{{ item.team }}"
                - name: namespace
                  value: "{{ item.namespace }}"
                - name: container_running_as
                  value: "{{ item.container_running_as }}"
                - name: environment
                  value: "{{ item.environment }}"
                - name: scm_source_branch
                  value: "{{ item.scm_source_branch }}"
            withParam: '
[ {   "image": "602401143452.dkr.ecr.eu-central-1.amazonaws.com/amazon-k8s-cni:v1.7.5",   "image_id": "602401143452.dkr.ecr.eu-central-1.amazonaws.com/amazon-k8s-cni@sha256:f310c918ee2b4ebced76d2d64a2ec128dde3b364d1b495f0ae73011f489d474d",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": true,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "602401143452.dkr.ecr.eu-central-1.amazonaws.com/eks/coredns:v1.7.0-eksbuild.1",   "image_id": "602401143452.dkr.ecr.eu-central-1.amazonaws.com/eks/coredns@sha256:edffc302f7adb1adc410d45ed2266d83c966bc195995191da63e035111e38afd",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": true,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "602401143452.dkr.ecr.eu-central-1.amazonaws.com/eks/kube-proxy:v1.18.9-eksbuild.1",   "image_id": "602401143452.dkr.ecr.eu-central-1.amazonaws.com/eks/kube-proxy@sha256:ae048a1187cc5e52992641d9f1d67f72c31a00cc84dfb2f1da31bb7ee2c34a51",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": true,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "amazon/aws-efs-csi-driver:v1.2.0",   "image_id": "amazon/aws-efs-csi-driver@sha256:41d8dd88233573244d75289f61afc95a24dbd8189fcf2541a19dfefc8f6dee5c",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "amazon/aws-for-fluent-bit:2.9.0",   "image_id": "amazon/aws-for-fluent-bit@sha256:a332fc78ac4c724c8e1605ae0fed59378e0112f60103f4d90dc698ce18e8cdf1",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "argoproj/argocd:v1.8.4",   "image_id": "argoproj/argocd@sha256:439393f0f7de91e8db45e99d1f0f2426b3c4c0081077e4b7d4fc9736b147f851",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "nobody",   "namespace": "argocd",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "atlassian/bitbucket-server:7.6-jdk11",   "image_id": "atlassian/bitbucket-server@sha256:3901578d12cf4153eb565d3a71a859109df950058bddf4561d2210e6a580bea0",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "kaplan",   "namespace": "bitbucket-sda-testing",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "bitnami/external-dns:0.7.6-debian-10-r0",   "image_id": "bitnami/external-dns@sha256:83dbeb7def34248f0a5139fb6793df04e708718320b14e1fe96d729e06d669c3",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "external-dns",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "bitnami/metrics-server:0.4.2-debian-10-r58",   "image_id": "bitnami/metrics-server@sha256:3116d4c143b5daeca61fa96c157146be7f3d2d60506cf081ceea487b5fe3cd31",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "bitnami/postgresql:11.7.0-debian-10-r26",   "image_id": "bitnami/postgresql@sha256:b9ad60ddf0acd04ae559770314c6d97393cc92d4fd057f9b92b2947a80a26cc9",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "kaplan",   "namespace": "sonarqube-sda-testing",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "defectdojo/defectdojo-django:1.13.2",   "image_id": "defectdojo/defectdojo-django@sha256:21cac59c1800bc50d4bfe05409ad5723250948c1dcf0dd87f3764a0e801837c1",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo-edithcare",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "defectdojo/defectdojo-django:1.13.2",   "image_id": "defectdojo/defectdojo-django@sha256:21cac59c1800bc50d4bfe05409ad5723250948c1dcf0dd87f3764a0e801837c1",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo-test",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "defectdojo/defectdojo-django:1.13.2",   "image_id": "defectdojo/defectdojo-django@sha256:21cac59c1800bc50d4bfe05409ad5723250948c1dcf0dd87f3764a0e801837c1",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo2",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "defectdojo/defectdojo-nginx:1.13.2",   "image_id": "defectdojo/defectdojo-nginx@sha256:79a40237dfb3e6345cfc4774ee1de8bf626d4b4e0b9613e9b818b4dc8aa57e4a",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo-edithcare",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "defectdojo/defectdojo-nginx:1.13.2",   "image_id": "defectdojo/defectdojo-nginx@sha256:79a40237dfb3e6345cfc4774ee1de8bf626d4b4e0b9613e9b818b4dc8aa57e4a",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo-test",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "defectdojo/defectdojo-nginx:1.13.2",   "image_id": "defectdojo/defectdojo-nginx@sha256:79a40237dfb3e6345cfc4774ee1de8bf626d4b4e0b9613e9b818b4dc8aa57e4a",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo2",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "eu.gcr.io/k8s-artifacts-prod/autoscaling/cluster-autoscaler:v1.18.1",   "image_id": "eu.gcr.io/k8s-artifacts-prod/autoscaling/cluster-autoscaler@sha256:1f5b11617389b8e4ce15eb45fdbbfd4321daeb63c234d46533449ab780b6ca9a",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "ghcr.io/helm/chartmuseum:v0.13.0",   "image_id": "ghcr.io/helm/chartmuseum@sha256:a44bc3bae305365365a5d39b85c42d6086a41f5f6da671a69ae052b675e1ddc7",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "chartmuseum",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "grafana/grafana:7.3.6",   "image_id": "grafana/grafana@sha256:1ff2070acde25450fc52613ca75519a6e74e57bb7e614210c1324002048682e4",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "monitoring",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "k8s.gcr.io/defaultbackend-amd64:1.5",   "image_id": "k8s.gcr.io/defaultbackend-amd64@sha256:4dc5e07c8ca4e23bddb3153737d7b8c556e5fb2f29c4558b7cd6e6df99c512c7",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "ingress-nginx",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "k8s.gcr.io/ingress-nginx/controller@sha256:3dd0fac48073beaca2d67a78c746c7593f9c575168a17139a9955a82c63c4b9a",   "image_id": "k8s.gcr.io/ingress-nginx/controller@sha256:3dd0fac48073beaca2d67a78c746c7593f9c575168a17139a9955a82c63c4b9a",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "ingress-nginx",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "kiwigrid/k8s-sidecar:0.1.275",   "image_id": "kiwigrid/k8s-sidecar@sha256:4ef7b5f142717a1af3a4c3df4991cdca271f29a45f1d10ca68d04072a34ca814",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "kiwigrid/k8s-sidecar:0.1.275",   "image_id": "kiwigrid/k8s-sidecar@sha256:4ef7b5f142717a1af3a4c3df4991cdca271f29a45f1d10ca68d04072a34ca814",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "kaplan",   "namespace": "jenkins-sda-health",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "kiwigrid/k8s-sidecar:0.1.275",   "image_id": "kiwigrid/k8s-sidecar@sha256:4ef7b5f142717a1af3a4c3df4991cdca271f29a45f1d10ca68d04072a34ca814",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-shared-apkv2",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "kiwigrid/k8s-sidecar:0.1.275",   "image_id": "kiwigrid/k8s-sidecar@sha256:4ef7b5f142717a1af3a4c3df4991cdca271f29a45f1d10ca68d04072a34ca814",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-shared-debeka",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "kiwigrid/k8s-sidecar:0.1.275",   "image_id": "kiwigrid/k8s-sidecar@sha256:4ef7b5f142717a1af3a4c3df4991cdca271f29a45f1d10ca68d04072a34ca814",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-shared-edith",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "kiwigrid/k8s-sidecar:0.1.275",   "image_id": "kiwigrid/k8s-sidecar@sha256:4ef7b5f142717a1af3a4c3df4991cdca271f29a45f1d10ca68d04072a34ca814",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-shared-kbs",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "kiwigrid/k8s-sidecar:0.1.275",   "image_id": "kiwigrid/k8s-sidecar@sha256:4ef7b5f142717a1af3a4c3df4991cdca271f29a45f1d10ca68d04072a34ca814",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-testing",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "kiwigrid/k8s-sidecar:1.1.0",   "image_id": "kiwigrid/k8s-sidecar@sha256:3e86186656d346b440519bf1f41c2784d10fc63f907eac7e4f2a4bda1a7331f0",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "monitoring",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "lmierzwa/karma:v0.50",   "image_id": "lmierzwa/karma@sha256:3751e5eed6568d45c88518f34e03559b84bfd62614d5c3b76a950d1a35024d55",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "overview",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "nginx/nginx-prometheus-exporter:0.8.0",   "image_id": "nginx/nginx-prometheus-exporter@sha256:d7347376302fdf07221b3476e3746d54224b1e2a5dcd3367ff343f9ff3e7e1a9",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo-edithcare",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "nginx/nginx-prometheus-exporter:0.8.0",   "image_id": "nginx/nginx-prometheus-exporter@sha256:d7347376302fdf07221b3476e3746d54224b1e2a5dcd3367ff343f9ff3e7e1a9",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo-test",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "nginx/nginx-prometheus-exporter:0.8.0",   "image_id": "nginx/nginx-prometheus-exporter@sha256:d7347376302fdf07221b3476e3746d54224b1e2a5dcd3367ff343f9ff3e7e1a9",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "defectdojo2",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "ocadotechnology/nexus-exporter:0.2.2",   "image_id": "ocadotechnology/nexus-exporter@sha256:8d30f2ecf7dc951b2ae14e874e735e5ff376d093a2d9c17bd2b56a842dab35e9",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "nobody",   "namespace": "nexus",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "ocadotechnology/nexus-exporter:0.2.2",   "image_id": "ocadotechnology/nexus-exporter@sha256:8d30f2ecf7dc951b2ae14e874e735e5ff376d093a2d9c17bd2b56a842dab35e9",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "nexus-shared-kbs",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "oliver006/redis_exporter:v1.13.1",   "image_id": "oliver006/redis_exporter@sha256:b684be379cb64548fbe66ebb2368fe20fd8652a4a191d363601dd37916a1b4a3",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "dock",   "namespace": "backstage",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "public.ecr.aws/eks-distro/kubernetes-csi/external-provisioner:v2.0.3-eks-1-18-1",   "image_id": "public.ecr.aws/eks-distro/kubernetes-csi/external-provisioner@sha256:b5ec0fbca3e30e3b2745d45dd499a9e60d39693bcb8e93c7ee4ee94e281bc6f5",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "public.ecr.aws/eks-distro/kubernetes-csi/livenessprobe:v2.1.0-eks-1-18-1",   "image_id": "public.ecr.aws/eks-distro/kubernetes-csi/livenessprobe@sha256:59b08c59faf94d29c18784800800d7dcf96ccea67cf71d9e0cae3e1f9c9fbea4",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "public.ecr.aws/eks-distro/kubernetes-csi/node-driver-registrar:v2.0.1-eks-1-18-1",   "image_id": "public.ecr.aws/eks-distro/kubernetes-csi/node-driver-registrar@sha256:9165724826f4361474f1cd05a6dad3300d4b7cd742cf7caf102343b1d921f43d",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/bitnami/sealed-secrets-controller:v0.13.1",   "image_id": "quay.io/bitnami/sealed-secrets-controller@sha256:ed7aba5fb4f05f7d719f0142c8b5c8b4a5b165f7f9322bbb3eb6e6bd94404a80",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "kube-system",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/coreos/kube-state-metrics:v1.9.7",   "image_id": "quay.io/coreos/kube-state-metrics@sha256:2f82f0da199c60a7699c43c63a295c44e673242de0b7ee1b17c2d5a23bec34cb",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "monitoring",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/dexidp/dex:v2.26.0",   "image_id": "quay.io/dexidp/dex@sha256:00f1df8362aecd81e14f049a18d66c00c5eee7c559ebed41e8a317c00765109a",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "nobody",   "namespace": "argocd",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/jetstack/cert-manager-cainjector:v1.1.0",   "image_id": "quay.io/jetstack/cert-manager-cainjector@sha256:5cd541e0af815c81b24e8ff3721257a0e309faecf78913774b58ca71984c4a46",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "cert-manager",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/jetstack/cert-manager-controller:v1.1.0",   "image_id": "quay.io/jetstack/cert-manager-controller@sha256:153d99b48570b053e599a03b918dbc80406ba1cf2137f14d5a80a9c7043ac06b",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "cert-manager",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/jetstack/cert-manager-webhook:v1.1.0",   "image_id": "quay.io/jetstack/cert-manager-webhook@sha256:4dd372a988c2a1287c72bac0e73987f6ab97c9b6b9551218f529b463acfbe711",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "cert-manager",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/oauth2-proxy/oauth2-proxy:v6.1.1",   "image_id": "quay.io/oauth2-proxy/oauth2-proxy@sha256:791aef35b8d1d2a325028b188d5a650605d69985a0dab1233c06079e7321eee0",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "oauth2-proxy",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/oauth2-proxy/oauth2-proxy:v7.1.2",   "image_id": "quay.io/oauth2-proxy/oauth2-proxy@sha256:103ccb53d5cef16fe3daced7792f99e952ffb3cc5f926c3c5b8afdc35abc4322",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "dock",   "namespace": "backstage",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/prometheus-operator/prometheus-config-reloader:v0.44.0",   "image_id": "quay.io/prometheus-operator/prometheus-config-reloader@sha256:6659cb3d97b5f846b5e1651ca1ab95189509f899713c727143f1bc50cc6e57cf",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "monitoring",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/prometheus-operator/prometheus-operator:v0.44.0",   "image_id": "quay.io/prometheus-operator/prometheus-operator@sha256:983627001c89bc6d7d881939c0c314c72ee26256004e8890c9e31efc498d7649",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "monitoring",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/prometheus/alertmanager:v0.21.0",   "image_id": "quay.io/prometheus/alertmanager@sha256:24a5204b418e8fa0214cfb628486749003b039c279c56b5bddb5b10cd100d926",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "monitoring",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/prometheus/node-exporter:v1.0.1",   "image_id": "quay.io/prometheus/node-exporter@sha256:cf66a6bbd573fd819ea09c72e21b528e9252d58d01ae13564a29749de1e48e0f",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "monitoring",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/prometheus/prometheus:v2.22.1",   "image_id": "quay.io/prometheus/prometheus@sha256:b899dbd1b9017b9a379f76ce5b40eead01a62762c4f2057eacef945c3c22d210",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "monitoring",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/clusterscanner-imagecollector:2.0",   "image_id": "quay.io/sdase/clusterscanner-imagecollector@sha256:f1b2a5f8ebda42017b51d35a3e04ed47cc2b41e81ac685b6b0ab7e51ee4f0e3e",   "slack": "#security-notifications",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "security",   "namespace": "cluster-scan",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/jenkins:0.2.5",   "image_id": "quay.io/sdase/jenkins@sha256:60ba16dd855b8e3d559ddb8f59fb67dee8f0f98ba41d51ee7eed9462d3638743",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/jenkins:0.2.5",   "image_id": "quay.io/sdase/jenkins@sha256:60ba16dd855b8e3d559ddb8f59fb67dee8f0f98ba41d51ee7eed9462d3638743",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "kaplan",   "namespace": "jenkins-sda-health",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/jenkins:0.2.5",   "image_id": "quay.io/sdase/jenkins@sha256:60ba16dd855b8e3d559ddb8f59fb67dee8f0f98ba41d51ee7eed9462d3638743",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-shared-apkv2",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/jenkins:0.2.5",   "image_id": "quay.io/sdase/jenkins@sha256:60ba16dd855b8e3d559ddb8f59fb67dee8f0f98ba41d51ee7eed9462d3638743",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-shared-debeka",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/jenkins:0.2.5",   "image_id": "quay.io/sdase/jenkins@sha256:60ba16dd855b8e3d559ddb8f59fb67dee8f0f98ba41d51ee7eed9462d3638743",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-shared-edith",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/jenkins:0.2.5",   "image_id": "quay.io/sdase/jenkins@sha256:60ba16dd855b8e3d559ddb8f59fb67dee8f0f98ba41d51ee7eed9462d3638743",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-shared-kbs",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/jenkins:0.2.5",   "image_id": "quay.io/sdase/jenkins@sha256:60ba16dd855b8e3d559ddb8f59fb67dee8f0f98ba41d51ee7eed9462d3638743",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "jenkins-testing",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus-config:v0.0.1",   "image_id": "quay.io/sdase/nexus-config@sha256:2153158d9c731b1c7a362e2939099e8484d9bfd85949ef5ae503fa932268f57f",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "nobody",   "namespace": "nexus",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus-config:v0.0.1",   "image_id": "quay.io/sdase/nexus-config@sha256:2153158d9c731b1c7a362e2939099e8484d9bfd85949ef5ae503fa932268f57f",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "kaplan",   "namespace": "nexus-sda-health",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus-config:v0.0.1",   "image_id": "quay.io/sdase/nexus-config@sha256:2153158d9c731b1c7a362e2939099e8484d9bfd85949ef5ae503fa932268f57f",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "nexus-shared-kbs",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus:3.30.0.1",   "image_id": "quay.io/sdase/nexus@sha256:2b735c0670813148ab46084adfc31e7a88cebb388727e45fc06169c9f83f1292",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "nobody",   "namespace": "nexus",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus:3.30.0.1",   "image_id": "quay.io/sdase/nexus@sha256:2b735c0670813148ab46084adfc31e7a88cebb388727e45fc06169c9f83f1292",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "kaplan",   "namespace": "nexus-sda-health",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus:3.30.0.1",   "image_id": "quay.io/sdase/nexus@sha256:2b735c0670813148ab46084adfc31e7a88cebb388727e45fc06169c9f83f1292",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "nobody",   "namespace": "nexus-shared-apkv",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus:3.30.0.1",   "image_id": "quay.io/sdase/nexus@sha256:2b735c0670813148ab46084adfc31e7a88cebb388727e45fc06169c9f83f1292",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "nexus-shared-debeka",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus:3.30.0.1",   "image_id": "quay.io/sdase/nexus@sha256:2b735c0670813148ab46084adfc31e7a88cebb388727e45fc06169c9f83f1292",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "nexus-shared-edith",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/nexus:3.30.0.1",   "image_id": "quay.io/sdase/nexus@sha256:2b735c0670813148ab46084adfc31e7a88cebb388727e45fc06169c9f83f1292",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "nexus-shared-kbs",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/sda-dsomm:latest",   "image_id": "quay.io/sdase/sda-dsomm@sha256:34e521070dc7be3742093521c6a22337e5411ec8d43c3cbfacd3eb7f8c42acd9",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "security",   "namespace": "dsomm",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/slackbot-patchmanagement:1.4.15",   "image_id": "quay.io/sdase/slackbot-patchmanagement@sha256:f0013aa81444badde3052170f1562152e0795b9304a8bbdb9dccbdc088c7d316",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "slackbot",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/terminal-backend-public:0.89.1",   "image_id": "quay.io/sdase/terminal-backend-public@sha256:0e99ddcfc6d82647a3e6c046eaa91ec76e9c48d68f8b25d04ccd9f21e373eae6",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "dock",   "namespace": "backstage",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/terminal-backend:0.89.1",   "image_id": "quay.io/sdase/terminal-backend@sha256:8700614f97eb00670c148a58b20148f2da4c30801177bc3d9982f15460c5c89b",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "dock",   "namespace": "backstage",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "quay.io/sdase/verdaccio:4.8.1",   "image_id": "quay.io/sdase/verdaccio@sha256:8b948502bb6a080984dd61967e3a649b0d1b246eb5c2b5a4f3ab7050f7913b4b",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "kaplan",   "namespace": "verdaccio-sda-health",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "redis:5.0.10-alpine",   "image_id": "redis@sha256:24b1579f67592ef53e4ea471ddece28718a89992790e6fe1a65a51d3ad769c7f",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "nobody",   "namespace": "argocd",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "sonarqube:8.5-developer",   "image_id": "sonarqube@sha256:8a2dfb908f83bc7999a5e751443db5ea7fd786dda9155e3e9b07bba4353c1f5e",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "kaplan",   "namespace": "sonarqube-sda-testing",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "velero/velero:v1.4.0",   "image_id": "velero/velero@sha256:6c85efba541fab1fe6aa7e6585bdbc898b990eb4e8de7b493e5fd7c6f1b676f0",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "5xx",   "namespace": "velero",   "container_running_as": "TODO",   "environment": "tools" }, {   "image": "wrouesnel/postgres_exporter:v0.8.0",   "image_id": "wrouesnel/postgres_exporter@sha256:520fcd04d6c8f922d800d89ae96c021f4afd22e376c4b88260a8b780e3375dbe",   "slack": "#security-security",   "scm_source_url": null,   "scm_source_branch": "notset",   "scm_release": null,   "skip": false,   "team": "dock",   "namespace": "backstage",   "container_running_as": "TODO",   "environment": "tools" } ]
'
            when: "{{ item.skip }} != true"
#      parallelism: 10

    - name: fetch-image-list
      outputs:
        artifacts:
          - name: image-lists
            path: /clusterscanner/out
            archive:
              none: {}
          - name: image-list-merged
            path: /clusterscanner/out/merged/merged.json
            archive:
              none: {}
      volumes:
        - name: github
          secret:
            secretName: github-test
        - name: tmp
          emptyDir: {}
      script:
        image: quay.io/sdase/clusterscanner-base:2
        imagePullPolicy: Always
        volumeMounts:
          - name: github
            mountPath: /clusterscanner/github/github_private_key.pem
            subPath: github_private_key.pem
          - name: tmp
            mountPath: /clusterscanner/out
        env:
          - name: GITHUB_KEY_FILE_PATH
            value: /clusterscanner/github/github_private_key.pem
        envFrom:
          - secretRef:
              name: "github-test"
        command: [/bin/bash]
        workingDir: /clusterscanner
        source: |
          source auth.bash
          sp_authorize #> /dev/null 2>&1
          sp_getfile https://api.github.com/repos/SDA-SE/cluster-scan-images-minikube/contents/output.json /clusterscanner/out/sdadev.json #> /dev/null 2>&1
          mkdir -p /clusterscanner/out/merged
          jq -s 'flatten' /clusterscanner/out/*.json > /clusterscanner/out/merged.json
          sed -i 's#"scm_source_branch": null#"scm_source_branch": "notset"#g' /clusterscanner/out/merged/merged.json


    - name: subflow
      inputs:
        parameters:
          - name: REGISTRY_SECRET
          - name: DEPENDENCY_SCAN_CM
          - name: DEFECTDOJO_CM
          - name: DEFECTDOJO_SECRETS
          - name: image
          - name: image_id
          - name: skip
          - name: environment
          - name: namespace
          - name: scm_source_branch
          - name: team
          - name: slack
          - name: container_running_as
      resource:
        action: create
        manifest: |
          apiVersion: argoproj.io/v1alpha1
          kind: Workflow
          metadata:
            generateName: scanjob-{{ inputs.parameters.environment }}-{{ inputs.parameters.namespace }}-{{ inputs.parameters.team }}-
          spec:
            arguments:
              parameters:
                - name: REGISTRY_SECRET
                  value: {{ inputs.parameters.REGISTRY_SECRET }}
                - name: DEPENDENCY_SCAN_CM
                  value: {{ inputs.parameters.DEPENDENCY_SCAN_CM }}
                - name: DEFECTDOJO_CM
                  value: {{ inputs.parameters.DEFECTDOJO_CM }}
                - name: DEFECTDOJO_SECRETS
                  value: {{ inputs.parameters.DEFECTDOJO_SECRETS }}
                - name: SCAN_ID
                  value: "{{ workflow.creationTimestamp.Y }}{{ workflow.creationTimestamp.m }}{{ workflow.creationTimestamp.d }}_{{ workflow.creationTimestamp.H }}{{ workflow.creationTimestamp.M }}{{ workflow.creationTimestamp.S }}"
                - name: team
                  value: {{ inputs.parameters.team }}
                - name: environment
                  value: {{ inputs.parameters.environment }}
                - name: namespace
                  value: {{ inputs.parameters.namespace }}
                - name: scm_source_branch
                  value: {{ inputs.parameters.scm_source_branch }}
                - name: image
                  value: {{ inputs.parameters.image }}
                - name: image_id
                  value: {{ inputs.parameters.image_id }}
                - name: slack
                  value: "{{ inputs.parameters.slack }}"
            workflowTemplateRef:
              name: scan-image-job
        successCondition: status.phase == Succeeded
        failureCondition: status.phase in (Failed, Error)